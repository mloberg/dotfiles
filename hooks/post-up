#!/usr/bin/env bash

# Vim plugins
if [ -d ~/.vim/autoload/plug.vim ]; then
  vim -E -s +PlugUpgrade +qa
else
  curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
      https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi
vim -u ~/.vimrc.bundles +PlugUpdate +PlugClean! +qa

reset -Q

# Install Homebrew packages
[ "$(uname -s)" == "Darwin" ] && brew update && brew bundle --global

# Remove broken symlinks
find -L ~/.bash.d -type l -ls -delete
find -L ~/.zsh/custom -type l -ls -delete
find -L ~ -type l -maxdepth 1 -ls -delete

# VS Code setup
settings_file="$HOME/Library/Application Support/Code/User/settings.json"
[ -L "$settings_file" ] || (rm -f "$settings_file" && ln -s "$HOME/.dotfiles/vscode/settings.json" "$settings_file")

installed_exts=$(code --list-extensions)
while read -r ext; do
  [[ "${installed_exts}" =~ $ext ]] || code --install-extension "$ext"
done < "$HOME/.dotfiles/vscode/extensions.txt"
